<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Music Renamer (no DB)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    button { margin-right: 1rem; margin-bottom: 1rem; padding: .6rem 1rem; }
    input[type="text"] { width: 600px; padding: .4rem; }
    pre { background:#111; color:#0f0; padding:1rem; border-radius:8px; white-space:pre-wrap; }
    .danger { background:#8b0000; color:#fff; }
    .row { margin-bottom: 1rem; }
    table { border-collapse: collapse; margin-top: 1rem; width: 100%; }
    th, td { text-align: left; padding: 6px 8px; border-bottom: 1px solid #eee; }
    .small { font-size: .9rem; color: #444; }
  </style>
</head>
<body>
  <h1>Music Renamer</h1>
  <p>This LAN-only UI renames files from <code>/inbox</code> using tags or filename heuristics. No database.</p>

  <div class="row">
    <button onclick="scan()">Scan</button>
    <button onclick="preview()">Preview rename</button>
    <button onclick="applyRename()">Apply rename</button>
  </div>

  <h3>Delete selected files</h3>
  <div class="row small">Paste absolute paths (one per line) you want to delete:</div>
  <textarea id="delpaths" rows="4" style="width:100%;"></textarea>
  <div class="row">
    <button class="danger" onclick="doDelete()">Delete</button>
  </div>

  <h3>Items</h3>
  <table id="tbl"><thead>
    <tr><th>File</th><th>Artist</th><th>Title</th><th>Ext</th></tr>
  </thead><tbody></tbody></table>

  <h3>Output</h3>
  <pre id="out"></pre>

<script>
async function call(url, body) {
  const res = await fetch(url, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(body || {})
  });
  return await res.json();
}

function setOut(obj) {
  document.getElementById('out').textContent =
    (obj.ok ? 'OK\n\n' : 'ERROR\n\n') + JSON.stringify(obj, null, 2);
}

function renderItems(items) {
  const tb = document.querySelector('#tbl tbody');
  tb.innerHTML = '';
  for (const it of items) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.rel || it.path}</td><td>${it.artist||''}</td><td>${it.title||''}</td><td>${it.ext||''}</td>`;
    tb.appendChild(tr);
  }
}

async function scan() {
  const j = await call('/api/scan', {});
  if (j.ok) renderItems(j.items || []);
  setOut(j);
}

async function preview() {
  const j = await call('/api/preview', {});
  setOut(j);
}

async function applyRename() {
  const j = await call('/api/apply', {});
  setOut(j);
  // after move, refresh list
  await scan();
}

async function doDelete() {
  const raw = document.getElementById('delpaths').value.trim();
  const paths = raw ? raw.split(/\r?\n/).map(s => s.trim()).filter(Boolean) : [];
  if (!paths.length) { alert('Please paste one or more absolute paths.'); return; }
  if (!confirm('Are you sure? This cannot be undone.')) return;
  const j = await call('/api/delete', {paths});
  setOut(j);
  await scan();
}
</script>
</body>
</html>